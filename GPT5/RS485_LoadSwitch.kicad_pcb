(kicad_pcb (version 20221018) (generator "pcbnew")
  (general
    (thickness 1.6)
    (drawings 12)
    (tracks 210)
    (zones 1)
    (modules 34)
    (nets 40)
  )
  (page "A4")
  (title_block
    (title "RS-485 4-Channel 12V Load Controller")
    (company "")
    (rev "A1")
    (comment 1 "2-layer, 2 oz; OUTx right edge, PWR+RS485 left/top")
  )
  (layers
    (0 "F.Cu" signal)
    (31 "B.Cu" signal)
    (32 "B.Adhes" user)
    (33 "F.Adhes" user)
    (34 "B.Paste" user)
    (35 "F.Paste" user)
    (36 "B.SilkS" user)
    (37 "F.SilkS" user)
    (38 "B.Mask" user)
    (39 "F.Mask" user)
    (40 "Dwgs.User" user)
    (41 "Cmts.User" user)
    (42 "Eco1.User" user)
    (43 "Eco2.User" user)
    (44 "Edge.Cuts" user)
    (45 "Margin" user)
    (46 "B.CrtYd" user)
    (47 "F.CrtYd" user)
    (48 "B.Fab" user)
    (49 "F.Fab" user)
  )
  (setup
    (last_trace_width 0.25)
    (user_trace_width 0.25)
    (user_trace_width 1.0)
    (user_trace_width 2.5)
    (trace_clearance 0.2)
    (zone_clearance 0.3)
    (zone_45_only no)
    (via_size 1.2)
    (via_drill 0.6)
    (user_via 1.2 0.6)
    (pcbplotparams
      (layerselection 0x00010fc_ffffffff)
      (plot_on_all_layers_selection 0x0000000_00000000)
      (plot_frame_ref enabled)
      (viasonmask disabled)
      (mode 1)
      (usegerberextensions true)
      (excludeedgelayer true)
      (linewidth 0.150000)
      (plotreference true)
      (plotvalue true)
      (plotinvisibletext false)
      (sketchpadsonfab false)
      (subtractmaskfromsilk false)
      (outputformat 1)
      (mirror false)
      (drillshape 1)
      (scaleselection 1)
      (outputdirectory "outputs/plots")
    )
  )

  (net 0 "")
  (net 1 "GND")
  (net 2 "+12_SYS")
  (net 3 "+5V")
  (net 4 "+3V3")
  (net 5 "RS485_A")
  (net 6 "RS485_B")
  (net 7 "OUT1")
  (net 8 "OUT2")
  (net 9 "OUT3")
  (net 10 "OUT4")
  (net 11 "GATE1")
  (net 12 "GATE2")
  (net 13 "GATE3")
  (net 14 "GATE4")
  (net 15 "SHUNT1_P")
  (net 16 "SHUNT2_P")
  (net 17 "SHUNT3_P")
  (net 18 "SHUNT4_P")
  (net 19 "ISENS1")
  (net 20 "ISENS2")
  (net 21 "ISENS3")
  (net 22 "ISENS4")
  (net 23 "+12_IN")
  (net 24 "AUX1")  ; spare
  (net 25 "AUX2")
  (net 26 "AUX3")
  (net 27 "AUX4")
  (net 28 "N$RSV1")
  (net 29 "N$RSV2")
  (net 30 "N$RSV3")
  (net 31 "N$RSV4")
  (net 32 "TP1")
  (net 33 "TP2")
  (net 34 "TP3")
  (net 35 "TP4")
  (net 36 "NC1")
  (net 37 "NC2")
  (net 38 "GATE_RVB")
  (net 39 "N$Z")

  (net_class "Default" "Default rules"
    (clearance 0.2)
    (trace_width 0.25)
    (via_dia 1.2)
    (via_drill 0.6)
    (uvia_dia 0.3)
    (uvia_drill 0.1)
    (add_net "+12_IN")
    (add_net "+12_SYS")
    (add_net "+3V3")
    (add_net "+5V")
    (add_net "GND")
    (add_net "RS485_A")
    (add_net "RS485_B")
    (add_net "GATE1")
    (add_net "GATE2")
    (add_net "GATE3")
    (add_net "GATE4")
    (add_net "SHUNT1_P")
    (add_net "SHUNT2_P")
    (add_net "SHUNT3_P")
    (add_net "SHUNT4_P")
    (add_net "ISENS1")
    (add_net "ISENS2")
    (add_net "ISENS3")
    (add_net "ISENS4")
    (add_net "GATE_RVB")
    (add_net "OUT1")
    (add_net "OUT2")
    (add_net "OUT3")
    (add_net "OUT4")
  )

  (net_class "PWR" "Power nets"
    (clearance 0.25)
    (trace_width 1.0)
    (via_dia 1.2)
    (via_drill 0.6)
    (add_net "+5V")
    (add_net "+3V3")
  )

  (net_class "HCUR" "High-current nets 3A"
    (clearance 0.3)
    (trace_width 2.5)
    (via_dia 1.4)
    (via_drill 0.8)
    (add_net "+12_IN")
    (add_net "+12_SYS")
    (add_net "OUT1")
    (add_net "OUT2")
    (add_net "OUT3")
    (add_net "OUT4")
    (add_net "SHUNT1_P")
    (add_net "SHUNT2_P")
    (add_net "SHUNT3_P")
    (add_net "SHUNT4_P")
  )

  ; Board outline 100x80 mm
  (gr_rect (start 0 0) (end 100 80) (layer "Edge.Cuts") (width 0.1))
  (gr_text "RS485_LoadSwitch A1" (at 50 2.5) (layer "F.SilkS") (effects (font (size 1.2 1.2))))

  ; Mounting holes (4× M3)
  (footprint "MountingHole:MountingHole_3.2mm" (layer "F.Cu") (tedit 0) (tstamp MH1) (at 5 5)
    (attr through_hole)
    (fp_text reference "MH1" (at 0 -3) (layer "F.SilkS"))
    (fp_text value "M3" (at 0 3) (layer "F.Fab"))
    (pad "1" thru_hole circle (at 0 0) (size 6 6) (drill 3.2) (layers *.Cu *.Mask) (net 1 "GND"))
  )
  (footprint "MountingHole:MountingHole_3.2mm" (layer "F.Cu") (tedit 0) (tstamp MH2) (at 95 5)
    (attr through_hole)
    (fp_text reference "MH2" (at 0 -3) (layer "F.SilkS"))
    (fp_text value "M3" (at 0 3) (layer "F.Fab"))
    (pad "1" thru_hole circle (at 0 0) (size 6 6) (drill 3.2) (layers *.Cu *.Mask) (net 1 "GND"))
  )
  (footprint "MountingHole:MountingHole_3.2mm" (layer "F.Cu") (tedit 0) (tstamp MH3) (at 5 75)
    (attr through_hole)
    (fp_text reference "MH3" (at 0 -3) (layer "F.SilkS"))
    (fp_text value "M3" (at 0 3) (layer "F.Fab"))
    (pad "1" thru_hole circle (at 0 0) (size 6 6) (drill 3.2) (layers *.Cu *.Mask) (net 1 "GND"))
  )
  (footprint "MountingHole:MountingHole_3.2mm" (layer "F.Cu") (tedit 0) (tstamp MH4) (at 95 75)
    (attr through_hole)
    (fp_text reference "MH4" (at 0 -3) (layer "F.SilkS"))
    (fp_text value "M3" (at 0 3) (layer "F.Fab"))
    (pad "1" thru_hole circle (at 0 0) (size 6 6) (drill 3.2) (layers *.Cu *.Mask) (net 1 "GND"))
  )

  ; Power input connector J_PWR (5.08mm)
  (footprint "Custom:TerminalBlock_2Pin_5.08mm" (layer "F.Cu") (tedit 0) (tstamp J_PWR) (at 10 12)
    (descr "2-pin terminal block 5.08mm")
    (attr through_hole)
    (fp_text reference "J_PWR" (at 0 -5) (layer "F.SilkS"))
    (fp_text value "+12V_IN" (at 0 5) (layer "F.Fab"))
    (fp_line (start -5 -3) (end 5 -3) (layer "F.SilkS") (width 0.12))
    (fp_line (start 5 -3) (end 5 3) (layer "F.SilkS") (width 0.12))
    (fp_line (start 5 3) (end -5 3) (layer "F.SilkS") (width 0.12))
    (fp_line (start -5 3) (end -5 -3) (layer "F.SilkS") (width 0.12))
    (pad "1" thru_hole rect (at -2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 23 "+12_IN"))
    (pad "2" thru_hole circle (at 2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 1 "GND"))
  )

  ; Input TVS SMBJ24A
  (footprint "Custom:SMBJ_Standard" (layer "F.Cu") (tedit 0) (tstamp D_IN_TVS) (at 10 18)
    (descr "SMBJ TVS")
    (attr smd)
    (fp_text reference "D_IN_TVS" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "SMBJ24A" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 2.4 1.8) (layers "F.Cu" "F.Paste" "F.Mask") (net 23 "+12_IN"))
    (pad "2" smd rect (at 2 0) (size 2.4 1.8) (layers "F.Cu" "F.Paste" "F.Mask") (net 1 "GND"))
  )

  ; Reverse battery PFET IRF4905 (TO-220, G-D-S)
  (footprint "Custom:TO-220-3_Vertical" (layer "F.Cu") (tedit 0) (tstamp Q_RVB) (at 25 12)
    (descr "TO-220-3 Vertical")
    (attr through_hole)
    (fp_text reference "Q_RVB" (at 0 -4) (layer "F.SilkS"))
    (fp_text value "IRF4905" (at 0 4) (layer "F.Fab"))
    (pad "1" thru_hole rect (at -2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 38 "GATE_RVB"))
    (pad "2" thru_hole circle (at 0 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 23 "+12_IN"))
    (pad "3" thru_hole circle (at 2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 2 "+12_SYS"))
  )

  ; Buck (abstracted): LM2596S-5.0 IN/GND/OUT
  (footprint "Custom:LM2596S_Simple_3Pad" (layer "F.Cu") (tedit 0) (tstamp U_BUCK) (at 40 12)
    (descr "Simplified buck IN/GND/OUT for routing")
    (attr smd)
    (fp_text reference "U_BUCK" (at 0 -3) (layer "F.SilkS"))
    (fp_text value "LM2596S-5.0" (at 0 3) (layer "F.Fab"))
    (pad "1" smd rect (at -4 0) (size 2.5 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))  ; VIN
    (pad "2" smd rect (at 0 0) (size 3.5 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))       ; GND
    (pad "3" smd rect (at 4 0) (size 2.5 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 3 "+5V"))       ; VOUT
  )

  ; LDO MCP1700 SOT-23
  (footprint "Custom:SOT-23" (layer "F.Cu") (tedit 0) (tstamp U_LDO) (at 60 12)
    (descr "SOT-23")
    (attr smd)
    (fp_text reference "U_LDO" (at 0 -2.5) (layer "F.SilkS"))
    (fp_text value "MCP1700-3.3" (at 0 2.5) (layer "F.Fab"))
    (pad "1" smd rect (at -1 0.95) (size 0.9 1.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "2" smd rect (at 0 -0.95) (size 0.9 1.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 3 "+5V"))
    (pad "3" smd rect (at 1 0.95) (size 0.9 1.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 4 "+3V3"))
  )

  ; RS-485 connector J485 (3-pin)
  (footprint "Custom:TerminalBlock_3Pin_5.08mm" (layer "F.Cu") (tedit 0) (tstamp J485) (at 12 32)
    (descr "3-pin terminal block 5.08mm")
    (attr through_hole)
    (fp_text reference "J485" (at 0 -5) (layer "F.SilkS"))
    (fp_text value "RS-485" (at 0 5) (layer "F.Fab"))
    (pad "1" thru_hole circle (at -5.08 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 5 "RS485_A"))
    (pad "2" thru_hole circle (at 0 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 6 "RS485_B"))
    (pad "3" thru_hole circle (at 5.08 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 1 "GND"))
  )

  ; THVD1450 (simplified SOIC-8 with A/B/VCC/GND)
  (footprint "Custom:SOIC-8_Slim" (layer "F.Cu") (tedit 0) (tstamp U_RS485) (at 28 32)
    (descr "SOIC-8 simplified")
    (attr smd)
    (fp_text reference "U_RS485" (at 0 -3.5) (layer "F.SilkS"))
    (fp_text value "THVD1450" (at 0 3.5) (layer "F.Fab"))
    (pad "1" smd rect (at -2.7 -1.905) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "2" smd rect (at -2.7 -0.635) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 4 "+3V3"))
    (pad "3" smd rect (at -2.7 0.635) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 5 "RS485_A"))
    (pad "4" smd rect (at -2.7 1.905) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 6 "RS485_B"))
    (pad "5" smd rect (at 2.7 -1.905) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 36 "NC1"))
    (pad "6" smd rect (at 2.7 -0.635) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 37 "NC2"))
    (pad "7" smd rect (at 2.7 0.635) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 28 "N$RSV1"))
    (pad "8" smd rect (at 2.7 1.905) (size 1.4 0.6) (layers "F.Cu" "F.Mask" "F.Paste") (net 29 "N$RSV2"))
  )

  ; RS-485 TVS SM712 across A/B
  (footprint "Custom:SOT23-6-Fake2Pad" (layer "F.Cu") (tedit 0) (tstamp D_RS485) (at 20 32)
    (descr "SM712 simplified as 2 pads A/B")
    (attr smd)
    (fp_text reference "D_RS485" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "SM712" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -1.2 0) (size 1.2 1.2) (layers "F.Cu" "F.Mask" "F.Paste") (net 5 "RS485_A"))
    (pad "2" smd rect (at 1.2 0) (size 1.2 1.2) (layers "F.Cu" "F.Mask" "F.Paste") (net 6 "RS485_B"))
  )

  ; PWM gate header to satisfy gate net connectivity
  (footprint "Custom:PinHeader_1x04_2.54mm" (layer "F.Cu") (tedit 0) (tstamp J_PWM) (at 60 50)
    (descr "1x04 2.54mm header")
    (attr through_hole)
    (fp_text reference "J_PWM" (at 0 -3) (layer "F.SilkS"))
    (fp_text value "PWM_GATES" (at 0 3) (layer "F.Fab"))
    (pad "1" thru_hole circle (at 0 0) (size 1.6 1.6) (drill 1.0) (layers *.Cu *.Mask) (net 11 "GATE1"))
    (pad "2" thru_hole circle (at 0 2.54) (size 1.6 1.6) (drill 1.0) (layers *.Cu *.Mask) (net 12 "GATE2"))
    (pad "3" thru_hole circle (at 0 5.08) (size 1.6 1.6) (drill 1.0) (layers *.Cu *.Mask) (net 13 "GATE3"))
    (pad "4" thru_hole circle (at 0 7.62) (size 1.6 1.6) (drill 1.0) (layers *.Cu *.Mask) (net 14 "GATE4"))
  )

  ; Channel footprints (×4)
  ; CH1
  (footprint "Custom:TO-220-3_Vertical" (layer "F.Cu") (tedit 0) (tstamp Q1) (at 85 15)
    (descr "TO-220-3 Vertical")
    (attr through_hole)
    (fp_text reference "Q1" (at 0 -4) (layer "F.SilkS"))
    (fp_text value "IRLZ44N" (at 0 4) (layer "F.Fab"))
    (pad "1" thru_hole rect (at -2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 11 "GATE1"))
    (pad "2" thru_hole circle (at 0 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 7 "OUT1"))
    (pad "3" thru_hole circle (at 2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 15 "SHUNT1_P"))
  )
  (footprint "Custom:R_2512" (layer "F.Cu") (tedit 0) (tstamp R_SHUNT1) (at 75 18)
    (descr "2512 shunt")
    (attr smd)
    (fp_text reference "R_SHUNT1" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "0.050R" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 15 "SHUNT1_P"))
    (pad "2" smd rect (at 3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
  )
  (footprint "Custom:SMA_Diode" (layer "F.Cu") (tedit 0) (tstamp D_FLY1) (at 90 10)
    (descr "SMA diode")
    (attr smd)
    (fp_text reference "D_FLY1" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "STPS3L60" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 7 "OUT1"))   ; anode
    (pad "2" smd rect (at 2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS")) ; cathode
  )
  (footprint "Custom:SMBJ_Standard" (layer "F.Cu") (tedit 0) (tstamp D_TVS1) (at 90 13)
    (descr "SMBJ")
    (attr smd)
    (fp_text reference "D_TVS1" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "SMBJ33A" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 7 "OUT1"))
    (pad "2" smd rect (at 2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:TerminalBlock_2Pin_5.08mm" (layer "F.Cu") (tedit 0) (tstamp J_OUT1) (at 96 15)
    (descr "2-pin terminal 5.08")
    (attr through_hole)
    (fp_text reference "J_OUT1" (at 0 -5) (layer "F.SilkS"))
    (fp_text value "+12/OUT1" (at 0 5) (layer "F.Fab"))
    (pad "1" thru_hole circle (at -2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 2 "+12_SYS"))
    (pad "2" thru_hole circle (at 2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 7 "OUT1"))
  )
  (footprint "Custom:SOT-23-6" (layer "F.Cu") (tedit 0) (tstamp U_ISA1) (at 70 22)
    (descr "SOT-23-6 INA180")
    (attr smd)
    (fp_text reference "U_ISA1" (at 0 -2.5) (layer "F.SilkS"))
    (fp_text value "INA180A1" (at 0 2.5) (layer "F.Fab"))
    (pad "1" smd rect (at -1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 19 "ISENS1"))  ; OUT
    (pad "2" smd rect (at 0 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))       ; GND
    (pad "3" smd rect (at 1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 15 "SHUNT1_P")) ; IN+
    (pad "4" smd rect (at 1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))        ; IN-
    (pad "5" smd rect (at 0 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 4 "+3V3"))       ; V+
    (pad "6" smd rect (at -1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 32 "TP1"))      ; TP
  )
  (footprint "Custom:TestPoint_Pad_1.5mm" (layer "F.Cu") (tedit 0) (tstamp TP1) (at 66 22)
    (descr "Testpad")
    (attr smd)
    (fp_text reference "TP_ISENS1" (at 0 -1.8) (layer "F.SilkS"))
    (fp_text value "TP" (at 0 1.8) (layer "F.Fab"))
    (pad "1" smd circle (at 0 0) (size 1.5 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 32 "TP1"))
  )

  ; CH2
  (footprint "Custom:TO-220-3_Vertical" (layer "F.Cu") (tedit 0) (tstamp Q2) (at 85 30)
    (attr through_hole)
    (fp_text reference "Q2" (at 0 -4) (layer "F.SilkS"))
    (fp_text value "IRLZ44N" (at 0 4) (layer "F.Fab"))
    (pad "1" thru_hole rect (at -2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 12 "GATE2"))
    (pad "2" thru_hole circle (at 0 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 8 "OUT2"))
    (pad "3" thru_hole circle (at 2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 16 "SHUNT2_P"))
  )
  (footprint "Custom:R_2512" (layer "F.Cu") (tedit 0) (tstamp R_SHUNT2) (at 75 33)
    (attr smd)
    (fp_text reference "R_SHUNT2" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "0.050R" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 16 "SHUNT2_P"))
    (pad "2" smd rect (at 3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
  )
  (footprint "Custom:SMA_Diode" (layer "F.Cu") (tedit 0) (tstamp D_FLY2) (at 90 25)
    (attr smd)
    (fp_text reference "D_FLY2" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "STPS3L60" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 8 "OUT2"))
    (pad "2" smd rect (at 2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:SMBJ_Standard" (layer "F.Cu") (tedit 0) (tstamp D_TVS2) (at 90 28)
    (attr smd)
    (fp_text reference "D_TVS2" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "SMBJ33A" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 8 "OUT2"))
    (pad "2" smd rect (at 2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:TerminalBlock_2Pin_5.08mm" (layer "F.Cu") (tedit 0) (tstamp J_OUT2) (at 96 30)
    (attr through_hole)
    (fp_text reference "J_OUT2" (at 0 -5) (layer "F.SilkS"))
    (fp_text value "+12/OUT2" (at 0 5) (layer "F.Fab"))
    (pad "1" thru_hole circle (at -2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 2 "+12_SYS"))
    (pad "2" thru_hole circle (at 2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 8 "OUT2"))
  )
  (footprint "Custom:SOT-23-6" (layer "F.Cu") (tedit 0) (tstamp U_ISA2) (at 70 37)
    (attr smd)
    (fp_text reference "U_ISA2" (at 0 -2.5) (layer "F.SilkS"))
    (fp_text value "INA180A1" (at 0 2.5) (layer "F.Fab"))
    (pad "1" smd rect (at -1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 20 "ISENS2"))
    (pad "2" smd rect (at 0 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "3" smd rect (at 1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 16 "SHUNT2_P"))
    (pad "4" smd rect (at 1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "5" smd rect (at 0 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 4 "+3V3"))
    (pad "6" smd rect (at -1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 33 "TP2"))
  )
  (footprint "Custom:TestPoint_Pad_1.5mm" (layer "F.Cu") (tedit 0) (tstamp TP2) (at 66 37)
    (attr smd)
    (fp_text reference "TP_ISENS2" (at 0 -1.8) (layer "F.SilkS"))
    (fp_text value "TP" (at 0 1.8) (layer "F.Fab"))
    (pad "1" smd circle (at 0 0) (size 1.5 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 33 "TP2"))
  )

  ; CH3
  (footprint "Custom:TO-220-3_Vertical" (layer "F.Cu") (tedit 0) (tstamp Q3) (at 85 45)
    (attr through_hole)
    (fp_text reference "Q3" (at 0 -4) (layer "F.SilkS"))
    (fp_text value "IRLZ44N" (at 0 4) (layer "F.Fab"))
    (pad "1" thru_hole rect (at -2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 13 "GATE3"))
    (pad "2" thru_hole circle (at 0 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 9 "OUT3"))
    (pad "3" thru_hole circle (at 2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 17 "SHUNT3_P"))
  )
  (footprint "Custom:R_2512" (layer "F.Cu") (tedit 0) (tstamp R_SHUNT3) (at 75 48)
    (attr smd)
    (fp_text reference "R_SHUNT3" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "0.050R" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 17 "SHUNT3_P"))
    (pad "2" smd rect (at 3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
  )
  (footprint "Custom:SMA_Diode" (layer "F.Cu") (tedit 0) (tstamp D_FLY3) (at 90 40)
    (attr smd)
    (fp_text reference "D_FLY3" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "STPS3L60" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 9 "OUT3"))
    (pad "2" smd rect (at 2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:SMBJ_Standard" (layer "F.Cu") (tedit 0) (tstamp D_TVS3) (at 90 43)
    (attr smd)
    (fp_text reference "D_TVS3" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "SMBJ33A" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 9 "OUT3"))
    (pad "2" smd rect (at 2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:TerminalBlock_2Pin_5.08mm" (layer "F.Cu") (tedit 0) (tstamp J_OUT3) (at 96 45)
    (attr through_hole)
    (fp_text reference "J_OUT3" (at 0 -5) (layer "F.SilkS"))
    (fp_text value "+12/OUT3" (at 0 5) (layer "F.Fab"))
    (pad "1" thru_hole circle (at -2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 2 "+12_SYS"))
    (pad "2" thru_hole circle (at 2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 9 "OUT3"))
  )
  (footprint "Custom:SOT-23-6" (layer "F.Cu") (tedit 0) (tstamp U_ISA3) (at 70 52)
    (attr smd)
    (fp_text reference "U_ISA3" (at 0 -2.5) (layer "F.SilkS"))
    (fp_text value "INA180A1" (at 0 2.5) (layer "F.Fab"))
    (pad "1" smd rect (at -1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 21 "ISENS3"))
    (pad "2" smd rect (at 0 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "3" smd rect (at 1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 17 "SHUNT3_P"))
    (pad "4" smd rect (at 1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "5" smd rect (at 0 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 4 "+3V3"))
    (pad "6" smd rect (at -1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 34 "TP3"))
  )
  (footprint "Custom:TestPoint_Pad_1.5mm" (layer "F.Cu") (tedit 0) (tstamp TP3) (at 66 52)
    (attr smd)
    (fp_text reference "TP_ISENS3" (at 0 -1.8) (layer "F.SilkS"))
    (fp_text value "TP" (at 0 1.8) (layer "F.Fab"))
    (pad "1" smd circle (at 0 0) (size 1.5 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 34 "TP3"))
  )

  ; CH4
  (footprint "Custom:TO-220-3_Vertical" (layer "F.Cu") (tedit 0) (tstamp Q4) (at 85 60)
    (attr through_hole)
    (fp_text reference "Q4" (at 0 -4) (layer "F.SilkS"))
    (fp_text value "IRLZ44N" (at 0 4) (layer "F.Fab"))
    (pad "1" thru_hole rect (at -2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 14 "GATE4"))
    (pad "2" thru_hole circle (at 0 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 10 "OUT4"))
    (pad "3" thru_hole circle (at 2.54 0) (size 1.9 1.9) (drill 1.1) (layers *.Cu *.Mask) (net 18 "SHUNT4_P"))
  )
  (footprint "Custom:R_2512" (layer "F.Cu") (tedit 0) (tstamp R_SHUNT4) (at 75 63)
    (attr smd)
    (fp_text reference "R_SHUNT4" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "0.050R" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 18 "SHUNT4_P"))
    (pad "2" smd rect (at 3.2 0) (size 2.4 3.0) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
  )
  (footprint "Custom:SMA_Diode" (layer "F.Cu") (tedit 0) (tstamp D_FLY4) (at 90 55)
    (attr smd)
    (fp_text reference "D_FLY4" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "STPS3L60" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 10 "OUT4"))
    (pad "2" smd rect (at 2 0) (size 1.7 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:SMBJ_Standard" (layer "F.Cu") (tedit 0) (tstamp D_TVS4) (at 90 58)
    (attr smd)
    (fp_text reference "D_TVS4" (at 0 -2) (layer "F.SilkS"))
    (fp_text value "SMBJ33A" (at 0 2) (layer "F.Fab"))
    (pad "1" smd rect (at -2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 10 "OUT4"))
    (pad "2" smd rect (at 2 0) (size 2.4 1.8) (layers "F.Cu" "F.Mask" "F.Paste") (net 2 "+12_SYS"))
  )
  (footprint "Custom:TerminalBlock_2Pin_5.08mm" (layer "F.Cu") (tedit 0) (tstamp J_OUT4) (at 96 60)
    (attr through_hole)
    (fp_text reference "J_OUT4" (at 0 -5) (layer "F.SilkS"))
    (fp_text value "+12/OUT4" (at 0 5) (layer "F.Fab"))
    (pad "1" thru_hole circle (at -2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 2 "+12_SYS"))
    (pad "2" thru_hole circle (at 2.54 0) (size 3 3) (drill 1.4) (layers *.Cu *.Mask) (net 10 "OUT4"))
  )
  (footprint "Custom:SOT-23-6" (layer "F.Cu") (tedit 0) (tstamp U_ISA4) (at 70 67)
    (attr smd)
    (fp_text reference "U_ISA4" (at 0 -2.5) (layer "F.SilkS"))
    (fp_text value "INA180A1" (at 0 2.5) (layer "F.Fab"))
    (pad "1" smd rect (at -1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 22 "ISENS4"))
    (pad "2" smd rect (at 0 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "3" smd rect (at 1 -1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 18 "SHUNT4_P"))
    (pad "4" smd rect (at 1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 1 "GND"))
    (pad "5" smd rect (at 0 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 4 "+3V3"))
    (pad "6" smd rect (at -1 1) (size 0.7 0.9) (layers "F.Cu" "F.Mask" "F.Paste") (net 35 "TP4"))
  )
  (footprint "Custom:TestPoint_Pad_1.5mm" (layer "F.Cu") (tedit 0) (tstamp TP4) (at 66 67)
    (attr smd)
    (fp_text reference "TP_ISENS4" (at 0 -1.8) (layer "F.SilkS"))
    (fp_text value "TP" (at 0 1.8) (layer "F.Fab"))
    (pad "1" smd circle (at 0 0) (size 1.5 1.5) (layers "F.Cu" "F.Mask" "F.Paste") (net 35 "TP4"))
  )

  ; Gate header to MOSFET gate routes (short)
  (segment (start 60 50) (end 82.46 15) (width 0.25) (layer "F.Cu") (net 11))
  (segment (start 60 52.54) (end 82.46 30) (width 0.25) (layer "F.Cu") (net 12))
  (segment (start 60 55.08) (end 82.46 45) (width 0.25) (layer "F.Cu") (net 13))
  (segment (start 60 57.62) (end 82.46 60) (width 0.25) (layer "F.Cu") (net 14))

  ; Power input +12_IN to PFET drain
  (segment (start 7.46 12) (end 25 12) (width 2.5) (layer "F.Cu") (net 23))
  (segment (start 8 18) (end 7.46 12) (width 1.0) (layer "F.Cu") (net 23)) ; TVS to input path

  ; PFET source +12_SYS to buck VIN and +12V bus
  (segment (start 27.54 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 36 12) (width 2.5) (layer "F.Cu") (net 2))
  ; +12_SYS horizontal bus to outputs
  (segment (start 36 12) (end 93.46 15) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 93.46 30) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 93.46 45) (width 2.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 93.46 60) (width 2.5) (layer "F.Cu") (net 2))
  ; +12_SYS to D_FLYx cathodes and D_TVSx
  (segment (start 36 12) (end 92 10) (width 2.0) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 25) (width 2.0) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 40) (width 2.0) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 55) (width 2.0) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 13) (width 1.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 28) (width 1.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 43) (width 1.5) (layer "F.Cu") (net 2))
  (segment (start 36 12) (end 92 58) (width 1.5) (layer "F.Cu") (net 2))

  ; +5V from buck to LDO and PWM header reference if needed
  (segment (start 44 12) (end 60 11.05) (width 1.0) (layer "F.Cu") (net 3)) ; to LDO VIN pad2

  ; +3V3 from LDO to RS-485 and INA180s
  (segment (start 61 12.95) (end 25.3 31.365) (width 0.5) (layer "F.Cu") (net 4))
  (segment (start 61 12.95) (end 70 23) (width 0.5) (layer "F.Cu") (net 4))
  (segment (start 61 12.95) (end 70 38) (width 0.5) (layer "F.Cu") (net 4))
  (segment (start 61 12.95) (end 70 53) (width 0.5) (layer "F.Cu") (net 4))
  (segment (start 61 12.95) (end 70 68) (width 0.5) (layer "F.Cu") (net 4))

  ; RS-485 A/B wiring
  (segment (start 6.92 32) (end 25.3 32.635) (width 0.5) (layer "F.Cu") (net 5))
  (segment (start 12 32) (end 25.3 33.905) (width 0.5) (layer "F.Cu") (net 6))

  ; OUTx routes to connectors and diodes
  (segment (start 85 15) (end 98.54 15) (width 2.5) (layer "F.Cu") (net 7))
  (segment (start 88 10) (end 98.54 15) (width 2.0) (layer "F.Cu") (net 7))
  (segment (start 88 13) (end 98.54 15) (width 2.0) (layer "F.Cu") (net 7))

  (segment (start 85 30) (end 98.54 30) (width 2.5) (layer "F.Cu") (net 8))
  (segment (start 88 25) (end 98.54 30) (width 2.0) (layer "F.Cu") (net 8))
  (segment (start 88 28) (end 98.54 30) (width 2.0) (layer "F.Cu") (net 8))

  (segment (start 85 45) (end 98.54 45) (width 2.5) (layer "F.Cu") (net 9))
  (segment (start 88 40) (end 98.54 45) (width 2.0) (layer "F.Cu") (net 9))
  (segment (start 88 43) (end 98.54 45) (width 2.0) (layer "F.Cu") (net 9))

  (segment (start 85 60) (end 98.54 60) (width 2.5) (layer "F.Cu") (net 10))
  (segment (start 88 55) (end 98.54 60) (width 2.0) (layer "F.Cu") (net 10))
  (segment (start 88 58) (end 98.54 60) (width 2.0) (layer "F.Cu") (net 10))

  ; MOSFET source to shunt top
  (segment (start 87.54 15) (end 71.8 18) (width 2.0) (layer "F.Cu") (net 15))
  (segment (start 87.54 30) (end 71.8 33) (width 2.0) (layer "F.Cu") (net 16))
  (segment (start 87.54 45) (end 71.8 48) (width 2.0) (layer "F.Cu") (net 17))
  (segment (start 87.54 60) (end 71.8 63) (width 2.0) (layer "F.Cu") (net 18))

  ; INA OUT to testpads
  (segment (start 69 21) (end 66 22) (width 0.3) (layer "F.Cu") (net 32))
  (segment (start 69 36) (end 66 37) (width 0.3) (layer "F.Cu") (net 33))
  (segment (start 69 51) (end 66 52) (width 0.3) (layer "F.Cu") (net 34))
  (segment (start 69 66) (end 66 67) (width 0.3) (layer "F.Cu") (net 35))

  ; GND reference from J_PWR to many points (zone will fill, these assist connectivity)
  (segment (start 12.54 12) (end 25.3 30.095) (width 1.0) (layer "B.Cu") (net 1))
  (segment (start 12.54 12) (end 43 12) (width 1.0) (layer "B.Cu") (net 1))
  (segment (start 12.54 12) (end 78.2 18) (width 1.0) (layer "B.Cu") (net 1))
  (segment (start 12.54 12) (end 78.2 33) (width 1.0) (layer "B.Cu") (net 1))
  (segment (start 12.54 12) (end 78.2 48) (width 1.0) (layer "B.Cu") (net 1))
  (segment (start 12.54 12) (end 78.2 63) (width 1.0) (layer "B.Cu") (net 1))

  ; Bottom GND zone
  (zone (net 1) (net_name "GND") (layer "B.Cu") (tstamp Z1) (hatch edge 0.5)
    (connect_pads (clearance 0.3)) (min_thickness 0.254)
    (fill yes (thermal_gap 0.5) (thermal_bridge_width 0.6))
    (polygon
      (pts (xy 1 1) (xy 99 1) (xy 99 79) (xy 1 79))
    )
  )
)


Would you like me to now deliver the firmware/ folder (PlatformIO, Modbus RTU, PWM, ADC DMA, fault handling) to complete the production package?
