(kicad_pcb (version 20221018) (generator pcbnew)

  (general
    (thickness 1.6)
    (legacy_teardrops no)
  )

  (paper "A4")
  
  (layers
    (0 "F.Cu" signal)
    (31 "B.Cu" signal)
    (32 "B.Adhes" user "B.Adhesive")
    (33 "F.Adhes" user "F.Adhesive")
    (34 "B.Paste" user)
    (35 "F.Paste" user)
    (36 "B.SilkS" user "B.Silkscreen")
    (37 "F.SilkS" user "F.Silkscreen")
    (38 "B.Mask" user)
    (39 "F.Mask" user)
    (40 "Dwgs.User" user "User.Drawings")
    (41 "Cmts.User" user "User.Comments")
    (42 "Eco1.User" user "User.Eco1")
    (43 "Eco2.User" user "User.Eco2")
    (44 "Edge.Cuts" user)
    (45 "Margin" user)
    (46 "B.CrtYd" user "B.Courtyard")
    (47 "F.CrtYd" user "F.Courtyard")
    (48 "B.Fab" user)
    (49 "F.Fab" user)
  )

  (setup
    (stackup
      (layer "F.SilkS" (type "Top Silk Screen"))
      (layer "F.Paste" (type "Top Solder Paste"))
      (layer "F.Mask" (type "Top Solder Mask") (thickness 0.01))
      (layer "F.Cu" (type "copper") (thickness 0.07))
      (layer "dielectric 1" (type "core") (thickness 1.51) (material "FR4") (epsilon_r 4.5) (loss_tangent 0.02))
      (layer "B.Cu" (type "copper") (thickness 0.07))
      (layer "B.Mask" (type "Bottom Solder Mask") (thickness 0.01))
      (layer "B.Paste" (type "Bottom Solder Paste"))
      (layer "B.SilkS" (type "Bottom Silk Screen"))
      (copper_finish "HASL")
      (dielectric_constraints no)
    )
    (pad_to_mask_clearance 0)
    (pcbplotparams
      (layerselection 0x00010fc_ffffffff)
      (plot_on_all_layers_selection 0x0000000_00000000)
      (disableapertmacros no)
      (usegerberextensions no)
      (usegerberattributes yes)
      (usegerberadvancedattributes yes)
      (creategerberjobfile yes)
      (dashed_line_dash_ratio 12.000000)
      (dashed_line_gap_ratio 3.000000)
      (svgprecision 4)
      (plotframeref no)
      (viasonmask no)
      (mode 1)
      (useauxorigin no)
      (hpglpennumber 1)
      (hpglpenspeed 20)
      (hpglpendiameter 15.000000)
      (dxfpolygonmode yes)
      (dxfimperialunits yes)
      (dxfusepcbnewfont yes)
      (psnegative no)
      (psa4output no)
      (plotreference yes)
      (plotvalue yes)
      (plotinvisibletext no)
      (sketchpadsonfab no)
      (subtractmaskfromsilk no)
      (outputformat 1)
      (mirror no)
      (drillshape 0)
      (scaleselection 1)
      (outputdirectory "gerbers/")
    )
  )

  (net 0 "")
  (net 1 "+12V")
  (net 2 "GND")
  (net 3 "+5V")
  (net 4 "+3V3")
  (net 5 "OUT1")
  (net 6 "OUT2")
  (net 7 "OUT3")
  (net 8 "OUT4")
  (net 9 "RS485_A")
  (net 10 "RS485_B")
  (net 11 "GATE1")
  (net 12 "GATE2")
  (net 13 "GATE3")
  (net 14 "GATE4")
  (net 15 "SENSE1")
  (net 16 "SENSE2")
  (net 17 "SENSE3")
  (net 18 "SENSE4")
  (net 19 "SWDIO")
  (net 20 "SWCLK")
  (net 21 "NRST")
  (net 22 "TX")
  (net 23 "RX")
  (net 24 "DE_RE")

  ; Board outline - 100x80mm compact industrial form factor
  (gr_rect (start 20 20) (end 120 100)
    (stroke (width 0.15) (type default)) (fill none) (layer "Edge.Cuts") (tstamp outline-main))

  ; Mounting holes with keepout zones
  (footprint "MountingHole:MountingHole_3.2mm_M3_Pad_Via" (layer "F.Cu")
    (tstamp mh1) (at 25 25)
    (property "Reference" "H1" (at 0 -4.2 0) (layer "F.SilkS"))
    (pad "1" thru_hole circle (at 0 0) (size 6 6) (drill 3.2) (layers "*.Cu" "*.Mask"))
    (zone (net 2) (net_name "GND") (layer "F.Cu") (tstamp mh1-zone) (hatch edge 0.5)
      (connect_pads yes (clearance 0.5))
      (min_thickness 0.25) (filled_areas_thickness no)
      (keepout (tracks not_allowed) (vias not_allowed) (pads allowed) (copperpour not_allowed) (footprints not_allowed))
      (fill (thermal_gap 0.5) (thermal_bridge_width 0.5))
      (polygon (pts (xy 22 22) (xy 28 22) (xy 28 28) (xy 22 28)))
    )
  )

  ; Power input connector - robust Phoenix Contact style
  (footprint "Connector_Phoenix_MC:PhoenixContact_MC_1,5_2-G-3.81_1x02_P3.81mm_Horizontal" (layer "F.Cu")
    (tstamp j1-power) (at 25 50 -90)
    (property "Reference" "J1" (at 0 -3 -90) (layer "F.SilkS"))
    (property "Value" "PWR_IN" (at 0 5 -90) (layer "F.Fab"))
    (pad "1" thru_hole rect (at 0 0 270) (size 2.4 2.4) (drill 1.5) (layers "*.Cu" "*.Mask") (net 1 "+12V"))
    (pad "2" thru_hole circle (at 3.81 0 270) (size 2.4 2.4) (drill 1.5) (layers "*.Cu" "*.Mask") (net 2 "GND"))
  )

  ; MOSFET Q1 with thermal vias
  (footprint "Package_TO_SOT_THT:TO-220-3_Vertical" (layer "F.Cu")
    (tstamp q1-mosfet) (at 95 30 0)
    (property "Reference" "Q1" (at 0 -4 0) (layer "F.SilkS"))
    (property "Value" "IRLZ44N" (at 0 3 0) (layer "F.Fab"))
    (pad "1" thru_hole rect (at -2.54 0) (size 1.8 1.8) (drill 1.1) (layers "*.Cu" "*.Mask") (net 11 "GATE1"))
    (pad "2" thru_hole circle (at 0 0) (size 1.8 1.8) (drill 1.1) (layers "*.Cu" "*.Mask") (net 5 "OUT1"))
    (pad "3" thru_hole circle (at 2.54 0) (size 1.8 1.8) (drill 1.1) (layers "*.Cu" "*.Mask") (net 2 "GND"))
    ; Thermal via array under tab
    (pad "" thru_hole circle (at 0 -5) (size 0.8 0.8) (drill 0.4) (layers "*.Cu") (net 5))
    (pad "" thru_hole circle (at -1 -5) (size 0.8 0.8) (drill 0.4) (layers "*.Cu") (net 5))
    (pad "" thru_hole circle (at 1 -5) (size 0.8 0.8) (drill 0.4) (layers "*.Cu") (net 5))
    (pad "" thru_hole circle (at 0 -6) (size 0.8 0.8) (drill 0.4) (layers "*.Cu") (net 5))
    (pad "" thru_hole circle (at -1 -6) (size 0.8 0.8) (drill 0.4) (layers "*.Cu") (net 5))
    (pad "" thru_hole circle (at 1 -6) (size 0.8 0.8) (drill 0.4) (layers "*.Cu") (net 5))
  )

  ; STM32 MCU placement - central location
  (footprint "Package_QFP:LQFP-48_7x7mm_P0.5mm" (layer "F.Cu")
    (tstamp u1-mcu) (at 60 60 0)
    (property "Reference" "U1" (at 0 -6 0) (layer "F.SilkS"))
    (property "Value" "STM32F103C8T6" (at 0 6 0) (layer "F.Fab"))
    ; Pad definitions for LQFP-48
    (pad "1" smd rect (at -4.25 -2.75) (size 1.5 0.3) (layers "F.Cu" "F.Paste" "F.Mask") (net 4 "+3V3"))
    ; ... [Additional pads 2-48]
    (pad "48" smd rect (at -4.25 2.75) (size 1.5 0.3) (layers "F.Cu" "F.Paste" "F.Mask") (net 4 "+3V3"))
    ; Thermal pad if present
    (pad "49" smd rect (at 0 0) (size 5 5) (layers "F.Cu" "F.Mask") (net 2 "GND"))
  )

  ; High-current traces - 3mm width for 3A
  (segment (start 25 50) (end 95 50) (width 3) (layer "F.Cu") (net 1))
  (segment (start 95 30) (end 110 30) (width 3) (layer "F.Cu") (net 5))
  
  ; Ground plane zones
  (zone (net 2) (net_name "GND") (layer "F.Cu") (tstamp gnd-top) (hatch edge 0.5)
    (priority 1)
    (connect_pads yes (clearance 0.5))
    (min_thickness 0.25) (filled_areas_thickness no)
    (fill yes (thermal_gap 0.5) (thermal_bridge_width 0.5))
    (polygon (pts
      (xy 20 20) (xy 120 20) (xy 120 100) (xy 20 100)
    ))
  )
  
  (zone (net 2) (net_name "GND") (layer "B.Cu") (tstamp gnd-bot) (hatch edge 0.5)
    (priority 1)
    (connect_pads yes (clearance 0.5))
    (min_thickness 0.25) (filled_areas_thickness no)
    (fill yes (thermal_gap 0.5) (thermal_bridge_width 0.5))
    (polygon (pts
      (xy 20 20) (xy 120 20) (xy 120 100) (xy 20 100)
    ))
  )

  ; Fiducial markers for automated assembly
  (footprint "Fiducial:Fiducial_1mm_Mask2mm" (layer "F.Cu")
    (tstamp fid1) (at 23 23)
    (property "Reference" "FID1" (at 0 -2 0) (layer "F.SilkS") hide)
    (pad "1" smd circle (at 0 0) (size 1 1) (layers "F.Cu" "F.Mask")
      (solder_mask_margin 0.5) (clearance 1))
  )
  
  (footprint "Fiducial:Fiducial_1mm_Mask2mm" (layer "F.Cu")
    (tstamp fid2) (at 117 23)
    (property "Reference" "FID2" (at 0 -2 0) (layer "F.SilkS") hide)
    (pad "1" smd circle (at 0 0) (size 1 1) (layers "F.Cu" "F.Mask")
      (solder_mask_margin 0.5) (clearance 1))
  )
  
  (footprint "Fiducial:Fiducial_1mm_Mask2mm" (layer "F.Cu")
    (tstamp fid3) (at 23 97)
    (property "Reference" "FID3" (at 0 -2 0) (layer "F.SilkS") hide)
    (pad "1" smd circle (at 0 0) (size 1 1) (layers "F.Cu" "F.Mask")
      (solder_mask_margin 0.5) (clearance 1))
  )
)
